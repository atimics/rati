FROM ghcr.io/foundry-rs/foundry:latest

# Switch to root user for installations
USER root

# Install Node.js - the Foundry image is Debian-based
RUN apt-get update && \
    apt-get install -y nodejs npm && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

WORKDIR /workspace

# Install anvil dependencies
COPY contracts/evm-receiver/package*.json ./contracts/evm-receiver/
RUN cd contracts/evm-receiver && npm ci --only=production

EXPOSE 8545

# Default to running anvil
CMD ["anvil", "--host", "0.0.0.0", "--port", "8545", "--block-time", "1"]